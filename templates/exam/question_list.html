{% extends 'exam/base.html' %}
{% block content %}

<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold">
        Questions â€“ {{ exam.title }}
    </h2>

    <a href="{% url 'exam:question_add' exam.id %}" class="bg-indigo-600 text-white px-4 py-2 rounded-lg">
        + Add Question
    </a>
</div>

<div class="bg-white shadow rounded-lg overflow-hidden">
    <table class="w-full text-sm">
        <thead class="bg-gray-100">
            <tr>
                <th class="p-3 text-left">Question</th>
                <th class="p-3">Marks</th>
                <th class="p-3">Correct</th>
                <th class="p-3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for q in questions %}
            <tr class="border-t">
                <td class="p-3">
                    {{ q.question_text|truncatechars:60 }}
                </td>
                <td class="text-center">{{ q.marks }}</td>
                <td class="text-center">{{ q.correct_option }}</td>
                <td class="p-3 text-center space-x-3">
                    <a href="{% url 'exam:question_update' q.id %}" class="text-blue-600 hover:underline">
                        Edit
                    </a>
                    <a href="{% url 'exam:question_delete' q.id %}" class="text-red-600 hover:underline">
                        Delete
                    </a>
                    <a href="#" onclick="openDeleteModal('{{ q.id }}', '{{ q.question_text|escapejs }}')"
                        class="text-red-600 hover:underline">
                        Delete
                    </a>

                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="p-6 text-center text-gray-500">
                    No questions added yet.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- Delete Confirmation Modal -->
<div id="deleteModal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">

    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6">
        <h2 class="text-xl font-bold text-red-600 mb-4">
            Delete Question
        </h2>

        <p class="mb-3 text-gray-700">
            Are you sure you want to delete this question?
        </p>

        <p id="questionText"
           class="italic text-gray-600 mb-6">
        </p>

        <form id="deleteForm" method="post">
            {% csrf_token %}
            <div class="flex justify-end gap-3">
                <button type="button"
                        onclick="closeDeleteModal()"
                        class="px-4 py-2 border rounded-lg">
                    Cancel
                </button>
                <button type="submit"
                        class="bg-red-600 text-white px-4 py-2 rounded-lg">
                    Delete
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function openDeleteModal(questionId, questionText) {
    const modal = document.getElementById('deleteModal');
    const form = document.getElementById('deleteForm');
    const text = document.getElementById('questionText');

    text.innerText = `"${questionText}"`;
    form.action = `/exam/question/${questionId}/delete/`;

    modal.classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
}
</script>


{% endblock %}