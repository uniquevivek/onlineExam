<!DOCTYPE html>
<html>

<head>
    <title>{{ schedule.exam }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

    <div class="max-w-5xl mx-auto p-6">

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">{{ schedule.exam }}</h2>
            <div class="text-red-600 font-semibold">
                Time Left: <span id="timer"></span>
            </div>
        </div>

        <div class="bg-white p-6 rounded shadow mb-6">
            <p>Exam content / questions will appear here.</p>
        </div>

        <form id="submitForm" method="POST" action="{% url 'student:submit_exam' schedule.id %}">
            {% csrf_token %}

            {% for question in questions %}
            <div class="bg-white p-5 rounded shadow mb-4">
                <p class="font-semibold mb-3">
                    Q{{ forloop.counter }}. {{ question.question_text }}
                </p>

                <label class="block mb-2">
                    <input type="radio" name="question_{{ question.id }}" value="A"
                        onclick="saveAnswer({{ question.id }}, 'A')">
                    {{ question.option_a }}
                </label>

                <label class="block mb-2">
                    <input type="radio" name="question_{{ question.id }}" value="B"
                        onclick="saveAnswer({{ question.id }}, 'B')">
                    {{ question.option_b }}
                </label>

                <label class="block mb-2">
                    <input type="radio" name="question_{{ question.id }}" value="C"
                        onclick="saveAnswer({{ question.id }}, 'C')">
                    {{ question.option_c }}
                </label>

                <label class="block mb-2">
                    <input type="radio" name="question_{{ question.id }}" value="D"
                        onclick="saveAnswer({{ question.id }}, 'D')">
                    {{ question.option_d }}
                </label>

            </div>
            {% endfor %}

            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded">
                Submit Exam
            </button>
        </form>


    </div>

    <script>
        let timeLeft = {{ remaining_seconds }};

        function updateTimer() {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;

            document.getElementById("timer").innerText =
                minutes + "m " + seconds + "s";

            if (timeLeft <= 0) {
                document.getElementById("submitForm").submit();
            }

            timeLeft--;
        }

        setInterval(updateTimer, 1000);
        updateTimer();
    </script>
    <script>
function saveAnswer(questionId, selectedOption) {

    fetch("{% url 'student:save_answer' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `question_id=${questionId}&selected_option=${selectedOption}&schedule_id={{ schedule.id }}`
    })
    .then(response => response.json())
    .then(data => {
        console.log("Answer saved");
    });
}
</script>


</body>

</html>